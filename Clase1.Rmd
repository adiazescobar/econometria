---
title: "An√°lisis de Secciones Transversales"
subtitle: "Microeconom√≠a Aplicada"
author: "Ana Mar√≠a D√≠az"
date: \today
output:
  xaringan::moon_reader:
    css: 
    ##- default 
    ##- metropolis 
    ##- metropolis-fonts
    ##- my-css.css
      - xaringan-themer.css
      - mi-tema.css
      - default
      - rladies
      - rladies-fonts 
    lib_dir: libs
    ##seal: false
    self_contained: false
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: 18:12
      slideNumberFormat: |
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: calc(%current% / %total% * 100%);">
          </div>
        </div>   

---
class: inverse, middle

```{r, setup, include = F}

#devtools::install_github("dill/emoGG")
library(pacman)
p_load(
  broom, tidyverse,
  latex2exp, ggplot2, ggthemes, ggforce, viridis, extrafont, gridExtra,
  kableExtra, snakecase, janitor,
  data.table, dplyr, estimatr,
  lubridate, knitr, parallel,
  lfe,
  here, magrittr
)
# Define pink color
red_pink <- "#e64173"
turquoise <- "#20B2AA"
orange <- "#FFA500"
red <- "#fb6107"
blue <- "#2b59c3"
green <- "#8bb174"
grey_light <- "grey70"
grey_mid <- "grey50"
grey_dark <- "grey20"
purple <- "#6A5ACD"
slate <- "#314f4f"
# Dark slate grey: #314f4f
# Knitr options
opts_chunk$set(
  comment = "#>",
  fig.align = "center",
  fig.height = 7,
  fig.width = 10.5,
  warning = F,
  message = F
)
opts_chunk$set(dev = "svg")
options(device = function(file, width, height) {
  svg(tempfile(), width = width, height = height)
})
options(crayon.enabled = F)
options(knitr.table.format = "html")
# A blank theme for ggplot
theme_empty <- theme_bw() + theme(
  line = element_blank(),
  rect = element_blank(),
  strip.text = element_blank(),
  axis.text = element_blank(),
  plot.title = element_blank(),
  axis.title = element_blank(),
  plot.margin = structure(c(0, 0, -0.5, -1), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_simple <- theme_bw() + theme(
  line = element_blank(),
  panel.grid = element_blank(),
  rect = element_blank(),
  strip.text = element_blank(),
  axis.text.x = element_text(size = 18, family = "STIXGeneral"),
  axis.text.y = element_blank(),
  axis.ticks = element_blank(),
  plot.title = element_blank(),
  axis.title = element_blank(),
  # plot.margin = structure(c(0, 0, -1, -1), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_axes_math <- theme_void() + theme(
  text = element_text(family = "MathJax_Math"),
  axis.title = element_text(size = 22),
  axis.title.x = element_text(hjust = .95, margin = margin(0.15, 0, 0, 0, unit = "lines")),
  axis.title.y = element_text(vjust = .95, margin = margin(0, 0.15, 0, 0, unit = "lines")),
  axis.line = element_line(
    color = "grey70",
    size = 0.25,
    arrow = arrow(angle = 30, length = unit(0.15, "inches")
  )),
  plot.margin = structure(c(1, 0, 1, 0), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_axes_serif <- theme_void() + theme(
  text = element_text(family = "MathJax_Main"),
  axis.title = element_text(size = 22),
  axis.title.x = element_text(hjust = .95, margin = margin(0.15, 0, 0, 0, unit = "lines")),
  axis.title.y = element_text(vjust = .95, margin = margin(0, 0.15, 0, 0, unit = "lines")),
  axis.line = element_line(
    color = "grey70",
    size = 0.25,
    arrow = arrow(angle = 30, length = unit(0.15, "inches")
  )),
  plot.margin = structure(c(1, 0, 1, 0), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_axes <- theme_void() + theme(
  text = element_text(family = "Fira Sans Book"),
  axis.title = element_text(size = 18),
  axis.title.x = element_text(hjust = .95, margin = margin(0.15, 0, 0, 0, unit = "lines")),
  axis.title.y = element_text(vjust = .95, margin = margin(0, 0.15, 0, 0, unit = "lines")),
  axis.line = element_line(
    color = grey_light,
    size = 0.25,
    arrow = arrow(angle = 30, length = unit(0.15, "inches")
  )),
  plot.margin = structure(c(1, 0, 1, 0), unit = "lines", valid.unit = 3L, class = "unit"),
  legend.position = "none"
)
theme_set(theme_gray(base_size = 20))
# Column names for regression results
reg_columns <- c("Term", "Est.", "S.E.", "t stat.", "p-Value")
# Function for formatting p values
format_pvi <- function(pv) {
  return(ifelse(
    pv < 0.0001,
    "<0.0001",
    round(pv, 4) %>% format(scientific = F)
  ))
}
format_pv <- function(pvs) lapply(X = pvs, FUN = format_pvi) %>% unlist()
# Tidy regression results table
tidy_table <- function(x, terms, highlight_row = 1, highlight_color = "black", highlight_bold = T, digits = c(NA, 3, 3, 2, 5), title = NULL) {
  x %>%
    tidy() %>%
    select(1:5) %>%
    mutate(
      term = terms,
      p.value = p.value %>% format_pv()
    ) %>%
    kable(
      col.names = reg_columns,
      escape = F,
      digits = digits,
      caption = title
    ) %>%
    kable_styling(font_size = 20) %>%
    row_spec(1:nrow(tidy(x)), background = "white") %>%
    row_spec(highlight_row, bold = highlight_bold, color = highlight_color)
}
# A few extras
xaringanExtra::use_xaringan_extra(c("tile_view", "fit_screen"))
```


---
class: clear
name: schedule

## Hoy

- Bienvenidos, reglas de juego
- Fundamentos de investigaci√≥n: *¬øPor qu√© estamos aqu√≠?* .grey-vlight[*MHE*: Prefacio y Cap√≠tulo 1]
- Nuestra clase: *¬øQu√© estamos haciendo?*

## Pr√≥ximamente

- Aprender m√°s .mono[Stata]: ¬°Primer Taller!
- Revisar t√©cnicas y desarrollar intuici√≥n para causalidad e inferencia.


## A largo plazo

.hi[Objetivo:] Profundizar en la comprensi√≥n y la intuici√≥n para la causalidad y la inferencia.

---

---

name: why

## ¬øPor qu√© estamos aqu√≠?

--

- .hi[Investigaci√≥n econ√≥mica]
--
.hi[:] Comprender los comportamientos humanos, sociales y/o econ√≥micos.

--

- .hi[Maestr√≠a]
--
.hi[:] Aprender m√©todos, herramientas, habilidades e intuici√≥n necesarios para la investigaci√≥n.

--

- .hi[Econometr√≠a (Aplicada)]
--
.hi[:] Construir un conjunto de herramientas de .pink[*m√©todos emp√≠ricos*, herramientas y habilidades] que combinan datos y conocimientos estad√≠sticos para probar y/o medir teor√≠as y pol√≠ticas.

--

- .hi[T√∫]
--
.hi[:] Deber√≠as estar pensando en esta pregunta a lo largo de tu programa/trabajo/vida.

---
# Esta clase

Aunque las calificaciones no son muy importantes .bigger[ü§∑], son necesarias.

- 25% Parcial 1
- 25% Parcial 2
- 20% Talleres Casa
- 5% Talleres Clase
- 25% Trabajo Final
-- Primera entrega. (10%) Presentaci√≥n de la idea de investigaci√≥n
Segunda entrega (20%). 5 p√°ginas de introducci√≥n, an√°lisis descriptivo y descripci√≥n de la metodolog√≠a.
Entrega final (30%). Documento definitivo. 
Sustentaci√≥n.(40%) 

--

El material y las herramientas son fundamentales para **mucho** de lo que har√°s en el futuro.

--

.hi[Toma responsabilidad de tu educaci√≥n y carrera.]

- Comprom√©tete a dedicar el tiempo necesario.
- S√© proactivo y curioso.
- Ad√©ntrate en temas espec√≠ficos.
- Haz preguntas.
- Aprende.

---

## ¬øQu√© estamos haciendo?

.hi[P] ¬øCu√°l es la diferencia entre *econometr√≠a* y *ciencia de datos*?
--
<br>.hi[P].sub[.pink[v2]] ¬øHay algo especial acerca de la *econometr√≠a*?

--

.hi[R].pink[.sub[1/‚àû]] Causalidad.<sup>.smallest[üò∏]</sup>

.footnote[
üò∏ Fuentes para esta Pregunta y Respuesta: [Dan Hammer](https://www.danham.me/r/about.html) y [Max Auffhammer](https://www.auffhammer.com/).
<br>.tran[blah]
]

--

La causalidad juega un *papel enorme* en la econometr√≠a aplicada moderna (especialmente en microeconom√≠a).

---
# Libros
layout: false
class: clear

.pull-left[
.hi-pink[Gu√≠a Pr√°ctica para la Evaluaci√≥n de Impacto]
<br>*Ximena Pe√±a y Raquel Bernal, 2008*
```{r, libro1, out.width = "50%", echo = F}
include_graphics("img/libro1.jpg")
```
]
.pull-right[
.b.red[Causal Inference: The Mixtape]
<br>*Scott Cunningham, 2021*
```{r, libro2, out.width = "50%", echo = F}
include_graphics("img/libro2.jfif")
```

Relativamente nuevo
<br>[Incluye](https://mixtape.scunning.com/index.html) R, Stata, and Python code.


]
---

layout: true

# Investigaci√≥n causal


---
# ¬øQu√© es Econom√≠a?

[https://PollEv.com/anamariadiaz707](https://PollEv.com/anamariadiaz707)

---

# ¬øQu√© es Econom√≠a?

[https://www.youtube.com/watch?v=iiYKRD8ochA](https://www.youtube.com/watch?v=iiYKRD8ochA)

.pull-left[
.b.blue[Oriana Bandeira]
```{r, ORIANA.png, out.width = "60%", echo = F}
include_graphics("img/ORIANA.png")
```
]

---
---

## Motivaci√≥n

> En primer lugar, creemos que .pink[la investigaci√≥n emp√≠rica es m√°s valiosa cuando utiliza datos para responder preguntas causales espec√≠ficas, *como si* se tratara de un ensayo cl√≠nico aleatorizado.] Esta perspectiva moldea nuestro enfoque hacia la mayor√≠a de las preguntas de investigaci√≥n. En ausencia de un experimento real, buscamos comparaciones bien controladas y/o cuasiexperimentos naturales. Por supuesto, algunos dise√±os de investigaci√≥n cuasiexperimentales son m√°s convincentes que otros, pero .purple[los m√©todos econom√©tricos utilizados en estos estudios suelen ser bastante simples].

*Mostly Harmless Econometrics*, p. xii 

--

.pink[1\. Esta ideolog√≠a compara inherentemente la investigaci√≥n con ensayos cl√≠nicos aleatorizados.]



---
## Microeconometr√≠a

- Efectos Causales
- Formulaci√≥n de pol√≠ticas basadas en evidencia (CCTs, Incentivos, Costo-beneficio)
- Entender Mecanismos (teor√≠a econ√≥mica)

---

## Microeconometr√≠a - Pol√≠tica P√∫blica

- Directos:
  1. Asignaci√≥n eficiente de los recursos
  2. Mejorar la calidad, la eficiencia y la efectividad de las intervenciones
  3. Centrarse en resultados
  4. Establecer la existencia de efectos no esperados en la ejecuci√≥n de un programa
  5. Rendici√≥n de cuentas

- Indirectos:
  1. Debate p√∫blico

---

## Microeconometr√≠a - Teor√≠a Econ√≥mica

- Mejor y m√°s informaci√≥n
- Menos distracciones
- Mejor Dise√±o
- Discusi√≥n transparente del dise√±o
- Retroalimentaci√≥n

---

## Ejemplos Exitosos 1: Progresa (Oportunidades M√©xico) 1990

- Objetivos:
  - Ofrecer a los hogares pobres un ingreso monetario de corto plazo y crear incentivos para que los ni√±os aumenten su capital humano
- ¬øC√≥mo?
  - Transferencias condicionadas a que los ni√±os asistieran al colegio y visitaran regularmente un centro de salud

---

## Resultados Iniciales 2001

- El programa estaba bien focalizado y hab√≠a generado cambios importantes en el capital humano de los hogares
- Shultz(2004): Progresa aument√≥ la asistencia escolar en 0.7 a√±os
- Gertler(2001): La incidencia de enfermedades disminuy√≥ en un 23%

---

## Resultados Generales

![](img/pegado2)

---

## Resultados Generales

![](img/pegado1.png)

---

## Ejemplos Exitosos 2: Desparasitaci√≥n

![](img/ted1.png)

---

## Desparasitaci√≥n

![](img/ted2.png)

---

## Desparasitaci√≥n

![](img/ted3.png)

---

## Desparasitaci√≥n

![](img/ted4.png)

---

## Ejemplos Exitosos 3: El Parrillero

![](img/motos1.png)

---

## Ejemplos Exitosos 3: El Parrillero

![](img/motos2.png)

---

name: faqs

## Preguntas frecuentes de Angrist y Pischke<sup>.pink[‚Ä†]</sup>

.footnote[
.pink[‚Ä†] Consulta *MHE*, cap√≠tulo 1.
.pink[‚Ä†‚Ä†] Estas preguntas son de [Reed Walker](https://w-reed-walker.com/).
]

1. ¬øCu√°l es la .hi[relaci√≥n causal de inter√©s]?

2. ¬øC√≥mo capturar√≠a un .hi[experimento ideal] este efecto causal de inter√©s?

3. ¬øCu√°l es tu .hi[estrategia de identificaci√≥n]?

4. ¬øCu√°l es tu .hi[modo de inferencia]?

--

***Nota:*** Otras preguntas tambi√©n importan para desarrollar una investigaci√≥n de calidad, *por ejemplo*,<sup>.pink[‚Ä†‚Ä†]</sup>

- ¬øPor qu√© tu pregunta es .hi[importante/interesante]?
- ¬øPor qu√© la .hi[literatura actual] carece o es inexistente?
- ¬øC√≥mo propones .hi[avanzar en la literatura]?

---
name: faq1

## Pregunta frecuente.sub[1]: ¬øCu√°l es la relaci√≥n causal de inter√©s?

Los ejercicios descriptivos pueden ser [muy interesantes e importantes](https://www.opportunityatlas.org/), pero en la econometr√≠a aplicada moderna, .hi-purple[la causalidad es la reina].

**¬øPor qu√©?**

--

- Las relaciones causales .hi-purple[ponen a prueba directamente] las teor√≠as sobre c√≥mo funciona el mundo.

- Las relaciones causales nos proporcionan .hi-purple[*contrafactuales*].

--

üöß Si no puedes nombrar claramente y de manera concisa la relaci√≥n causal de inter√©s, es posible que no tengas realmente un proyecto de investigaci√≥n.

---

## Pregunta frecuente.sub[1]: ¬øCu√°l es la relaci√≥n causal de inter√©s?

*Algunos ejemplos cl√°sicos...*

**Trabajo y educaci√≥n**<br>¬øC√≥mo afecta un a√±o adicional de educaci√≥n a los salarios?

**Econom√≠a pol√≠tica y desarrollo**<br>¬øC√≥mo afectan las instituciones democr√°ticas al desarrollo econ√≥mico?

**Medio ambiente y √°reas urbanas**<br>¬øLos pobres reciben beneficios sustanciales de la limpieza del medio ambiente?

**Salud, crimen y derecho**<br>¬øLas leyes de control de armas realmente reducen la violencia armada?

---
name: faq2

## Pregunta frecuente.sub[2]: ¬øCu√°l es el experimento ideal para esta situaci√≥n?

Describir el *experimento ideal* nos ayuda a formular

- las .pink[preguntas causales exactas]

- las dimensiones que queremos .pink[manipular]

- los factores que necesitamos .pink[mantener constantes]

--

üöß Estos *experimentos ideales* suelen ser hipot√©ticos, pero si no puedes describir el ideal, probablemente ser√° dif√≠cil obtener datos y dise√±os de investigaci√≥n plausibles en la vida real.

--

Angrist y Pischke llaman preguntas sin experimentos ideales "preguntas fundamentalmente sin respuesta".

---

## Pregunta frecuente.sub[2]: ¬øCu√°l es el experimento ideal para esta situaci√≥n?

*Ejemplos de preguntas potencialmente respondibles...*

- **El efecto de la educaci√≥n en los salarios:** Asignar al azar becas o incentivos para permanecer en el sistema educativo.
- **Democracia y desarrollo:** Asignar arbitrariamente tipos institucionales a los pa√≠ses al obtener su independencia.
- **Limpieza del medio ambiente:** Pedir a la Secretar√≠a de Medio Ambiente que limpie aleatoriamente sitios t√≥xicos.
- **Leyes de control de armas:** Asignar restricciones de armas aleatoriamente a cuadrantes.

--

*Ejemplos de preguntas desafiantes de responder (¬øpotencialmente sin respuesta?)...*

- ¬øC√≥mo afecta el g√©nero a las trayectorias profesionales futuras?
- ¬øQu√© papel juega la raza en los salarios de una persona?

---

## Pregunta frecuente.sub[2]: ¬øCu√°l es el experimento ideal para esta situaci√≥n?

A veces, incluso preguntas que parecen simples resultan ser fundamentalmente sin respuesta.

*Ejemplo de una pregunta fundamentalmente sin respuesta*:
> ¬øLos ni√±os tienen un mejor rendimiento al comenzar la escuela a una edad m√°s avanzada?

--

**Propuesta de experimento ideal**

1. Asignar al azar a los ni√±os para comenzar el 1.er grado a los 6 o 7 a√±os.
2. Comparar los resultados de las pruebas en el 2.¬∫ grado.

--

.hi[Problema]
--
Los ni√±os mayores tienen un mejor rendimiento. ¬øQueremos medir el efecto de comenzar m√°s tarde o simplemente de ser mayor?

---



# Conceptos Importantes

### El Contrafactual

¬øCu√°l habr√≠a sido el resultado para los participantes si NO hubieran participado en √©l?

---

## El Contrafactual

.pull-left[
.b.blue[Participante]
```{r, ninas1, out.width = "40%", echo = F}
include_graphics("img/ninas1.png")
```
  $Y_1 \Rightarrow$ RESULTADO OBSERVADO
]
.pull-right[
.b.blue[No Participante]
```{r, ninas1c, out.width = "40%", echo = F}
include_graphics("img/ninas1.png")
```
 $Y_0 \Rightarrow$ RESULTADO DEL CONTRAFACTUAL
 ]

---

## Resultados Potenciales

Para cada individuo, tenemos DOS resultados potenciales:

- $Y_i(D=0)$: resultado si $i$ NO recibe el tratamiento
- $Y_i(D=1)$: resultado si $i$ recibe el tratamiento

---

## Resultados Potenciales: Ejemplo 1

Carolina tiene una pierna rota. Tratamiento: $D=0$ No ir al hospital, $D=1$ Ir al hospital

- $Y_i(D=0)$: si ella no va al hospital, su pierna no se recupera
- $Y_i(D=1)$: si ella va al hospital, su pierna no se recupera

---

## Resultados Potenciales: Ejemplo 2

Camila tiene una pierna rota. Tratamiento: $D=0$ No ir al hospital, $D=1$ Ir al hospital

- $Y_i(D=0)$: si ella no va al hospital, su pierna no se recupera
- $Y_i(D=1)$: si ella va al hospital, su pierna se recupera

---

## Resultados Potenciales: Ejemplo 3

M√≥nica tiene una pierna rota. Tratamiento: $D=0$ No ir al hospital, $D=1$ Ir al hospital

- $Y_i(D=0)$: si ella no va al hospital, su pierna se recupera
- $Y_i(D=1)$: si ella va al hospital, su pierna no se recupera

---

## Problema Fundamental de Inferencia Causal

Nunca observamos los dos resultados potenciales para el mismo individuo. Crea un problema de datos no observados (missing data) al comparar tratados con los controles.

---

## Resultado Observado

Nosotros solo observamos uno de los resultados potenciales. Nuestra variable $Y_i$:

$$Y_i = \begin{cases}
  Y_i(D=0) & \text{si } D_i = 0 \\
  Y_i(D=1) & \text{si } D_i = 1 \\
\end{cases}$$

Donde $D_i$ es el indicador de tratamiento (es igual a 1 si fue tratado).

---

## Establecer Causalidad

En el mundo ideal (para los investigadores), podr√≠amos clonar a cada individuo tratado y observar los impactos del tratamiento en los resultados de inter√©s.

.pull-left[
.b.blue[Tratado]
```{r, ninas1a, out.width = "40%", echo = F}
include_graphics("img/ninas1.png")
```
  $Y_1 \Rightarrow$ RESULTADO OBSERVADO
]
.pull-right[
.b.blue[Control]
```{r, ninas1b, out.width = "40%", echo = F}
include_graphics("img/ninas1.png")
```
 $Y_0 \Rightarrow$ RESULTADO DEL CONTRAFACTUAL
 ]

---

---

## Video Mastering Metrics

[Ver video](https://youtu.be/iPBV3BlV7jk)

---
---
class: center, middle, inverse

## Ceteris Paribus

### Todos los dem√°s factores permanecen constantes

---

## Establecer Causalidad

- Nosotros nunca observamos el contrafactual
- Soluciones
  - Buscar una persona similar en todas las caracter√≠sticas
  - Diferencias de medias de grupos (na√Øve --> Sesgo de Selecci√≥n)
  - Diferencias antes y despu√©s (na√Øve --> Sesgo de maduraci√≥n)
---

## Soluci√≥n 1. Buscar una persona similar 

**Ceteris Paribus: ¬øPERFECTO?**

.pull-left[ **Tratada** 
```{r,  out.width = "40%", echo = F}
include_graphics("img/ninas1.png")
```
- $Y_{1} \Rightarrow$ RESULTADO OBSERVADO
]

.pull-right[ **Control** 
```{r, ninas3, out.width = "35%", echo = F}
include_graphics("img/ninas3.png")
```
- $Y_{0} \Rightarrow$ RESULTADO DEL CONTRAFACTUAL
]

---

## Efecto promedio del tratamiento (Average Treatment Effect- ATE)

$$ATE = E[\tau] = E[Y_i(D=1) - Y_i(D=0)]$$
Si no observamos los resultados potenciales para cada individuo, mucho menos para un grupo de individuos.

---

## Soluci√≥n 2: Diferencia de Medias= Efecto Causal + Sesgo de Selecci√≥n

.pull-left[ **Tratados** 
```{r,  out.width = "40%", echo = F}
include_graphics("img/pegado3.png")
```
]

.pull-right[ **Controles** 
```{r,  out.width = "40%", echo = F}
include_graphics("img/pegado4.png")
```
]
---
---

## SESGO DE SELECCI√ìN

Hay diferencias sistem√°ticas entre los grupos comparados de un estudio.

---

## Sesgo de Selecci√≥n

Incluso en una muestra grande:

- Las personas eligen participar en un programa cuando esperan tener beneficios de √©l $(Y_i(D=1)-Y_i(D=0)$
- Es probable que las personas que eligen participar sean diferentes a las que deciden no hacerlo ... incluso en ausencia del tratamiento.

---

## Soluci√≥n 3: Diferencias Antes-Despu√©s = Efecto Causal + Efecto de Maduraci√≥n

Comparaciones antes-despu√©s asumen que no hay tendencia en la variable de resultado.

---

## COMPARACIONES PROHIBIDAS

- Tratados vs Controles
- Pre-tratamiento vs Post-tratamiento

Se requieren supuestos extremadamente fuertes (l√©ase: imposibles de cumplir en la realidad) para que cualquiera de estos dos enfoques podamos obtener efectos causales.

---

## ¬øY Entonces?

.pull-left[
```{r, simon11, out.width = "60%", echo = F}
include_graphics("img/simon1.jpeg")
```
.fuente[ fuente: @banrepcultural]
]


---

## ¬øC√≥mo podemos estimar efectos causales?

**Experimentos Controlados**
- Asignaci√≥n aleatoria al tratamiento

**M√©todos Cuasi-Experimentales**
- Diferencias en Diferencias
- Emparejamiento
- Variables Instrumentales
- Regresi√≥n Discontinua
- Funci√≥n de Control
- Controles Sint√©ticos
- Causal Machine Learning



---
class: center, middle

# Gracias!

Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).
